---
title: "Normalizing and plotting vowels with phonR 1.0-0"
subtitle: ""
author: "Daniel R. McCloy"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Normalizing and plotting vowels with phonR 1.0-0}
  %\VignetteEngine{knitr::rmarkdown}
  %\usepackage[utf8]{inputenc}
---

# Introduction
The `phonR` package provides functions for vowel formant frequency and $f_0$ normalization, as well as a vowel plotting function `plotVowels` with many advanced features. There are also several helper functions that serve to simplify the `phonR` codebase; those are described in the documentation distributed with the package, but are not discussed further here. `phonR` also includes sample data in the form of F1 and F2 measurements for eight speakers of Standard Indonesian.

# Installation
The phonR package can be downloaded from the [Comprehensive R Archive Network](http://cran.r-project.org/package=phonR) or installed through `R` via `install.packages("phonR")`. The source code is hosted on [GitHub](https://github.com/drammock/phonR), and is licensed under [GPL-3](http://www.gnu.org/licenses/gpl.html). `phonR` has three dependencies (all relating to the vowel space heatmaps): `deldir` (for Delaunay triangulations), `plotrix` (for creating color scales), and `splancs` (for point-in-polygon functions). Plotting vowels with non-ASCII characters (i.e., most vowel symbols in the IPA) also requires that the user’s computer have a typeface installed that contains glyphs at the necessary codepoints, and that the user specify that typeface when calling the `plotVowels` function.

# The `plotVowels` function
The `plotVowels` function has been developed to be maximally compatible with the base `R` function `plot`, so that many familiar function arguments and graphical parameters can be passed to `plotVowels` and work as expected. Arguments like `family` for specifying font family, `xlab`, `ylab`, `main` and `sub` for axis annotation and titles, or `xlim` and `ylim` for specifying axis bounds are all respected. Other arguments applicable to direct-to-file plotting are also respected (e.g., `filename`, `width`, `height`, `res`, `units`, etc). Finally, just as with the base `plot` function, arguments specific to the individual components of the plot such as `cex.main`, `col.axis`, or `font.main` are available to specify the size, color, and font style of titles, axes, and axis labels.

## Minimal example
Using the included `indo` vowel data, the default behavior of `plotVowels` is not much different from a standard `plot` command, with the exception that the axis directions are reversed (as is standard practice in linguistics).

```{r, fig.cap="Minimal example of `plotVowels` function."}
library(phonR)
data(indoVowels)  # provides dataframe "indo"
with(indo, plotVowels(f1, f2))
```

## The arguments `vowel`, `group`, `col.by` and `style.by`
Of course, there is little point in plotting all the vowels with the same symbol, and without further information, `plotVowels` doesn't know which F1 and F2 values belong to which vowel and which talker or group. It also doesn't know how you want them plotted, which is why the next plot looks just like the previous one: even though we have *semantically* distinguished them by telling `plotVowels` which formant values belong to which vowel / talker, we haven't specified any way of *visually* distinguishing the points on the plot.

```{r, fig.cap="A near-minimal example, illustrating that simply specifying vowel and group is not enough."}
with(indo, plotVowels(f1, f2, vowel, group=subj))
```

The next plot solves this problem by specifying how to assign colors and styles to the plot. On the left, both color and symbol redundantly encode vowel identity. On the right, color encodes the gender of the talker, and symbol type again encodes vowel identity. Notice that in neither of these plots are we making use of the `group` argument; as we will see later, `group` is used for the calculation of vowel means and the drawing of ellipses and polygons based on those means, but is functionally independent from the means of controlling color and style.

```{r, fig.show='hold', fig.cap="Illustration of the `col.by` and `style.by` arguments."}
with(indo, plotVowels(f1, f2, vowel, group=subj, col.by=vowel, style.by=vowel))
with(indo, plotVowels(f1, f2, vowel, group=subj, col.by=gender, style.by=vowel))
```

## The `pretty` argument
By now you will have noticed that the default colors and symbols are ugly, and the axes are on the wrong sides of the plot (from a phonetician’s perspective, anyway). `plotVowels` has a wonderful argument called `pretty` that sets a whole bunch of default color and style options all at once, as a shortcut to getting plots that are easy on the eyes. Take a look at the same two plots you just saw, but `pretty`:

```{r, fig.show='hold', fig.cap="Default appearance with `pretty=TRUE`."}
with(indo, plotVowels(f1, f2, vowel, group=subj, col.by=vowel, style.by=vowel, pretty=TRUE))
with(indo, plotVowels(f1, f2, vowel, group=subj, col.by=gender, style.by=vowel, pretty=TRUE))
```

Don’t worry if you don’t love the colors, or want different symbols or a different size: anything that `pretty` changes can be overridden by explicitly including extra graphical arguments in the `plotVowels` function call, while leaving the remaining `pretty` options in place. The only thing you can’t undo is the axis placement on the top and right instead of bottom and left — that one is hard-wired. We’ll be leaving `pretty=TRUE` from now on, so you’ll see how it affects other aspects of the plots as we proceed.

## Tokens, means, and groups
As we have seen, the default for `plotVowels` is to plot each individual vowel token, potentially colored and styled in different ways. But sometimes a summary view is helpful to look at group differences. This is easily achieved by turning off the `plot.tokens` argument (which defaults to `TRUE`) and turning on the `plot.means` argument (which defaults to `FALSE`). <!--Of course, you can always set both to `TRUE` if you prefer; if you do, there are arguments to style and size them independently (`pch.tokens`, `cex.tokens`, `pch.means`, and `cex.means`).--> Now that we’re calculating means for each vowel, the `group` argument becomes important. These next two plots show the mean F1 and F2 values for each vowel, but with different grouping factors: on the left, the mean for each vowel is calculated within-speaker; on the right, the means are calculated within gender groups.

```{r, fig.show='hold', fig.cap=""}
with(indo, plotVowels(f1, f2, vowel, group=subj, plot.tokens=FALSE, plot.means=TRUE, col.by=gender, style.by=vowel, pretty=TRUE))
with(indo, plotVowels(f1, f2, vowel, group=gender, plot.tokens=FALSE, plot.means=TRUE, col.by=gender, style.by=vowel, pretty=TRUE))
```

## Replacing symbols with text

```{r, fig.cap=""}
with(indo, plotVowels(f1, f2, vowel, group=gender, plot.tokens=FALSE, plot.means=TRUE, pch.means=vowels, col.by=gender, style.by=vowel, pretty=TRUE))
```



<!-- The `plotVowels` function was developed to enhance the flexibility and visual appeal of vowel plots, especially plots showing data from multiple talkers or talker groups on a single graph. To that end, several options are available in `plotVowels` that are unavailable or difficult to achieve with other vowel plotting tools (the `vowels` package in R [@vowelsR] and its associated website NORM [@norm] being a popular alternative). In particular, `phonR` implements confidence interval plotting for vowel formant frequency means based on bivariate normal density contours, allowing for ellipsoids in F2×F1 space whose major and minor axes are not restricted to the horizontal or vertical, and whose confidence level can be easily adjusted.[^ellipse] Additionally, the `plotVowels` function can visualize the vowel space in several ways, e.g., by drawing convex polygons that encompass all vowel tokens, by drawing polygons connecting vowel formant mean values (in any order specified by the user, with the option to omit some vowels), or by drawing heatmaps that color-code the degree of vowel category overlap or encroachment. Apart from the heatmap, each of these visualization tools (ellipses, convex hulls, and polygons connecting vowel means) can be plotted separately for each talker or group, with variation in color and/or linestyle to distinguish them. Vowel means and individual vowel tokens may be plotted with any arbitrary text (including IPA glyphs) or geometric symbols; either tokens or means may be also be omitted.

[^ellipse]: Ellipse drawing is a possible in the `vowels` package, though not in its NORM web frontend.
-->

# Vowel normalization with `phonR`
`phonR` implements eight different vowel formant frequency normalization function algorithms as separate functions, and additionally provides a convenience function `normalizeVowels` that wraps to the individual functions, specified by a `method` argument. The algorithms implemented are listed in Table 1. Most of the normalization functions accept a vector or matrix of $f_0$ or formant frequencies, and return a vector or matrix of the same dimensions.



| **Normalization method**               | **Function name**   | **Source**           | **Formula**                                           |
|:---------------------------------------|:--------------------|:---------------------|:------------------------------------------------------|
| Bark                                   | `normBark`          | [@traunmuller1990]   | $ \frac {26.81 \times F_n}{1960+F_n} - 0.53 $         |
| Equivalent Rectangular Bandwidth (ERB) | `normErb`           | [@glasbergMoore1990] | $ 21.4 \times \log_{10} (1 + F_n \times 0.00437) $    |
| Mel                                    | `normMel`           | [@mel]               | $ 2595 \times \log_{10} (1 + \frac{F_n}{700}) $       |
| Log                                    | `normLog`           | n/a                  | $ \log_{10}(F_n) $                                    |
| Lobanov (z‑score)                      | `normLobanov`       | [@lobanov1971]       | $ \frac{F_n - \mu(F_n)}{\sigma(F_n)} $                |
| Watt-Fabricius (s‑centroid)[^wf]       | `normWattFabricius` | [@wattFabricius2002] | $ \frac{F_n}{centroid} $                              |
| Nearey‑1 (logmean)                     | `normLogmean`       | [@nearey1977]        | $ \log_{e} (F_n) - \mu(\log_{e}(F_n)) $               |
| Nearey‑2 (nearey)                      | `normNearey`        | [@nearey1977]        | $ \log_{e}(F_n) - \sum_{n=0}^{3} \mu(\log_{e}(F_n)) $ |

\caption{Normalization methods available via `phonR` \texttt{normalizeVowels} function}

[^wf]: In `phonR`, the centroid is defined as the point $ \langle \frac{\min(\overline{F2}_{vowel})+\max(\overline{F2}_{vowel})}{2}, \frac{2 \times \min(\overline{F1}_{vowel})+\max(\overline{F1}_{vowel})}{3} \rangle $.  This varies slightly from the formula in [@wattFabricius2002], since the `phonR` implementation simply calculates which vowel has the highest mean F1 value and designates it as low corner of the triangle, rather than asking the user to expressly specify the *trap* or *start* vowel. Similarly, the `phonR` implementation simply calculates which vowel has the highest mean F2 value and uses that to calculate the upper left corner, rather than expressly looking for the mean of the “point-vowel” /i/.  The upper right corner is, as in the original method, derived from the other two corners.


<!--
## Styles
The `html_vignette` template includes a basic CSS theme. To override this theme you can specify your own CSS in the document metadata as follows:

    output:
      rmarkdown::html_vignette:
        css: mystyles.css

## Figures
The figure sizes have been customised so that you can easily put two images side-by-side.

```{r, fig.show='hold'}
plot(1:10)
plot(10:1)
```

You can enable figure captions by `fig_caption: yes` in YAML:
    output:
      rmarkdown::html_vignette:
        fig_caption: yes
Then you can use the chunk option `fig.cap = "Your figure caption."` in **knitr**.

## More Examples
You can write math expressions, e.g. $Y = X\beta + \epsilon$, footnotes^[A footnote here.], and tables, e.g. using `knitr::kable()`.

```{r, echo=FALSE, results='asis'}
knitr::kable(head(mtcars, 10))
```

Also a quote using `>`:

> "He who gives up [code] safety for [code] speed deserves neither."
([via](https://twitter.com/hadleywickham/status/504368538874703872))
-->
